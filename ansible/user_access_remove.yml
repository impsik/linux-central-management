#!/usr/bin/env ansible-playbook
- name: Remove user
  hosts: all
  remote_user: ubuntu
  become: true

  # Prefer non-interactive usage:
  #   ansible-playbook -i inventory.yml user_access_remove.yml -e target_hosts=... -e username=...
  vars_prompt:
    - name: username
      prompt: "Enter username: "
      private: false
#    - name: target_hosts
#      prompt: "Enter target hosts (FQDN, group, 'all', or space-separated hosts):"
#      private: false

  pre_tasks:
    - name: Validate inputs
      ansible.builtin.assert:
        that:
          - username is defined
          - username | length > 0
        fail_msg: "Missing username (pass -e username=<name> or use the prompt)."

  tasks:
    - name: Remove user {{ username }}
      ansible.builtin.user:
        name: "{{ username }}"
        state: absent
        remove: true
